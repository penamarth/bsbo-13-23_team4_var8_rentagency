Прецедент: Аренда жилья квартиросъемщиком (Tenant)

Название: Аренда жилья.

Основной исполнитель (Actor): Квартиросъемщик (Tenant).

Второстепенные исполнители: Владелец (Owner), Платежная система (через PaymentGatewayAdapter).

Предусловия:

1. Квартиросъемщик (Tenant) является зарегистрированным пользователем (User) с ролью TENANT и выполнил вход в систему (login()).
2. В системе существуют объекты недвижимости (Property) со статусом AVAILABLE.

Основной поток событий:

1. Поиск жилья. Система отображает каталог доступной недвижимости. Квартиросъемщик использует функцию searchApartments(criteria), задавая параметры (район, цена, тип жилья PropertyType). Система возвращает список подходящих объектов Property.
2. Просмотр деталей. Квартиросъемщик выбирает понравившийся объект. Система отображает детали (getDetails()): адрес, цену, описание, тип и текущий статус (AVAILABLE).
3. Подача заявки. Квартиросъемщик решает арендовать выбранную недвижимость и нажимает "Подать заявку". Система выполняет метод submitApplication(property), который:
   · Создает новый объект Application, связывая его с текущим Tenant и выбранным Property.
   · Устанавливает статус заявки (Application.status) в PENDING.
   · Меняет статус самого объекта Property (Property.status) на UNDER_MODERATION (или оставляет AVAILABLE, в зависимости от бизнес-логики, но диаграмма предполагает смену статусов).
4. Рассмотрение заявки (вне системы). Владелец (Owner) в своем интерфейсе видит новую заявку. Он может одобрить (APPROVED) или отклонить (REJECTED) ее. Этот шаг может выполняться вручную или автоматически.
5. Оплата (если заявка одобрена). Допустим, владелец одобрил заявку. Система меняет статус Application.status на APPROVED. Квартиросъемщик получает уведомление и выбирает "Оплатить". Система выполняет метод makePayment(application):
   · Создает объект Payment, связывая его с заявкой (Application).
   · Устанавливает его статус (Payment.status) как PENDING (или сразу инициирует процесс).
   · Вызывает адаптер платежного шлюза PaymentGatewayAdapter.processPayment(...), передавая данные.
   · После взаимодействия с внешней системой, шлюз возвращает результат через paymentCallback(...).
6. Подтверждение оплаты. Платежный шлюз уведомляет адаптер об успешной оплате (SUCCESS). Система:
   · Меняет статус объекта Payment на SUCCESS.
   · Меняет статус заявки (Application.status) на PAID.
   · Ключевое действие: Меняет статус объекта недвижимости (Property.status) на RENTED. Объект больше не отображается в результатах поиска для других квартиросъемщиков.
7. Завершение прецедента. Система отображает сообщение об успешной аренде и оплате. Квартиросъемщик может перейти к разделу "Мои аренды".

Альтернативные потоки:

· А2 (Владелец отклонил заявку):
  · На шаге 4 владелец отклоняет заявку. Система меняет Application.status на REJECTED.
  · Статус Property.status возвращается в AVAILABLE.
  · Прецедент завершается. Квартиросъемщик получает уведомление об отказе.
· А5 (Оплата не удалась):
  · На шаге 5 платежный шлюз возвращает статус FAILED.
  · Система меняет Payment.status на FAILED. Статус заявки (Application.status) может остаться APPROVED или измениться на PENDING, давая возможность повторить попытку оплаты. Статус объекта Property остается UNDER_MODERATION или AVAILABLE.
  · Прецедент возвращается к шагу 5 (повторная попытка оплаты) или завершается с ошибкой.

Постусловия:

1. В системе создан и сохранен объект Application с финальным статусом (PAID или REJECTED).
2. Создан и сохранен объект Payment (в случае успешной оплаты).
3. Статус объекта Property обновлен (RENTED в случае успеха или AVAILABLE в случае отклонения/неудачи).
4. Квартиросъемщик (Tenant) и владелец (Owner) могут оставить друг другу отзывы через сущность Comment.
